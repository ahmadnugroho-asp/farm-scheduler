<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farm Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        .module-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .module-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="bg-gray-50">
    <script>
        // Suppress CDN warnings in production
        (function() {
            const originalWarn = console.warn;
            console.warn = function(...args) {
                const message = args[0];
                if (typeof message === 'string') {
                    if (message.includes('cdn.tailwindcss.com')) return;
                    if (message.includes('in-browser Babel transformer') ||
                        message.includes('precompile your scripts')) return;
                }
                originalWarn.apply(console, args);
            };
        })();
    </script>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Translations
        const translations = {
            en: {
                appTitle: 'Farm Management System',
                welcome: 'Welcome to',
                subtitle: 'Manage your farm operations efficiently',
                modules: 'Farm Modules',
                taskScheduler: 'Task Scheduler',
                taskSchedulerDesc: 'Plan and track daily farm tasks and assignments',
                inventory: 'Inventory Management',
                inventoryDesc: 'Track supplies, equipment, and resources',
                livestock: 'Livestock Tracking',
                livestockDesc: 'Monitor animal health, breeding, and production',
                financial: 'Financial Management',
                financialDesc: 'Track expenses, revenue, and financial reports',
                reports: 'Reports & Analytics',
                reportsDesc: 'View insights and generate farm reports',
                settings: 'Settings',
                settingsDesc: 'Configure system preferences and user accounts',
                openModule: 'Open Module',
                comingSoon: 'Coming Soon',
                lastUpdate: 'Last updated',
                footer: '¬© 2025 Farm Management System. All rights reserved.',
                tasksByStatus: 'Tasks by Status',
                statusNew: 'New',
                statusInProgress: 'In Progress',
                statusPending: 'Pending',
                statusDone: 'Done',
                totalTasks: 'Total Tasks',
            },
            id: {
                appTitle: 'Sistem Manajemen Peternakan',
                welcome: 'Selamat Datang di',
                subtitle: 'Kelola operasi peternakan Anda dengan efisien',
                modules: 'Modul Peternakan',
                taskScheduler: 'Penjadwal Tugas',
                taskSchedulerDesc: 'Rencanakan dan lacak tugas dan penugasan harian peternakan',
                inventory: 'Manajemen Inventaris',
                inventoryDesc: 'Lacak persediaan, peralatan, dan sumber daya',
                livestock: 'Pelacakan Ternak',
                livestockDesc: 'Monitor kesehatan, pembiakan, dan produksi hewan',
                financial: 'Manajemen Keuangan',
                financialDesc: 'Lacak pengeluaran, pendapatan, dan laporan keuangan',
                reports: 'Laporan & Analitik',
                reportsDesc: 'Lihat wawasan dan buat laporan peternakan',
                settings: 'Pengaturan',
                settingsDesc: 'Konfigurasi preferensi sistem dan akun pengguna',
                openModule: 'Buka Modul',
                comingSoon: 'Segera Hadir',
                lastUpdate: 'Terakhir diperbarui',
                footer: '¬© 2025 Sistem Manajemen Peternakan. Hak cipta dilindungi.',
                tasksByStatus: 'Tugas Berdasarkan Status',
                statusNew: 'Baru',
                statusInProgress: 'Sedang Dikerjakan',
                statusPending: 'Tertunda',
                statusDone: 'Selesai',
                totalTasks: 'Total Tugas',
            }
        };

        // Module definitions
        const modules = [
            {
                id: 'task-scheduler',
                icon: 'üìã',
                titleKey: 'taskScheduler',
                descKey: 'taskSchedulerDesc',
                url: '/task-scheduler.html',
                available: true,
                color: 'from-blue-500 to-blue-600'
            },
            {
                id: 'inventory',
                icon: 'üì¶',
                titleKey: 'inventory',
                descKey: 'inventoryDesc',
                url: null,
                available: false,
                color: 'from-green-500 to-green-600'
            },
            {
                id: 'livestock',
                icon: 'üêÑ',
                titleKey: 'livestock',
                descKey: 'livestockDesc',
                url: null,
                available: false,
                color: 'from-yellow-500 to-yellow-600'
            },
            {
                id: 'financial',
                icon: 'üí∞',
                titleKey: 'financial',
                descKey: 'financialDesc',
                url: null,
                available: false,
                color: 'from-purple-500 to-purple-600'
            },
            {
                id: 'reports',
                icon: 'üìä',
                titleKey: 'reports',
                descKey: 'reportsDesc',
                url: null,
                available: false,
                color: 'from-red-500 to-red-600'
            },
            {
                id: 'settings',
                icon: '‚öôÔ∏è',
                titleKey: 'settings',
                descKey: 'settingsDesc',
                url: null,
                available: false,
                color: 'from-gray-500 to-gray-600'
            }
        ];

        function App() {
            const [language, setLanguage] = useState('en');
            const [currentTime, setCurrentTime] = useState(new Date());
            const [tasks, setTasks] = useState([]);
            const [loading, setLoading] = useState(true);

            // Fetch tasks from API
            const fetchTasks = async () => {
                try {
                    const response = await fetch('/api/tasks');
                    if (response.ok) {
                        const data = await response.json();
                        setTasks(data.tasks || []);
                    }
                } catch (error) {
                    console.log('Could not fetch tasks:', error);
                    setTasks([]);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                // Load language preference
                const savedLanguage = localStorage.getItem('farmLanguage');
                if (savedLanguage) {
                    setLanguage(savedLanguage);
                }

                // Fetch tasks on mount
                fetchTasks();

                // Update time every minute
                const timer = setInterval(() => {
                    setCurrentTime(new Date());
                }, 60000);

                return () => clearInterval(timer);
            }, []);

            const t = translations[language];

            const handleLanguageChange = (newLang) => {
                setLanguage(newLang);
                localStorage.setItem('farmLanguage', newLang);
            };

            const handleModuleClick = (module) => {
                if (module.available && module.url) {
                    window.location.href = module.url;
                }
            };

            // Calculate task counts by status
            const taskCounts = {
                new: tasks.filter(t => t.status === 'New').length,
                inProgress: tasks.filter(t => t.status === 'Inprogress').length,
                pending: tasks.filter(t => t.status === 'Pending').length,
                done: tasks.filter(t => t.status === 'Done').length,
                total: tasks.length
            };

            return (
                <div className="min-h-screen flex flex-col">
                    {/* Header */}
                    <header className="gradient-bg text-white shadow-lg">
                        <div className="container mx-auto px-4 py-6">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="text-3xl font-bold">{t.appTitle}</h1>
                                    <p className="text-blue-100 mt-1">{t.subtitle}</p>
                                </div>

                                {/* Language Switcher */}
                                <div className="flex items-center gap-2">
                                    <button
                                        onClick={() => handleLanguageChange('en')}
                                        className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                                            language === 'en'
                                                ? 'bg-white text-purple-600'
                                                : 'bg-purple-500 text-white hover:bg-purple-400'
                                        }`}
                                    >
                                        EN
                                    </button>
                                    <button
                                        onClick={() => handleLanguageChange('id')}
                                        className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                                            language === 'id'
                                                ? 'bg-white text-purple-600'
                                                : 'bg-purple-500 text-white hover:bg-purple-400'
                                        }`}
                                    >
                                        ID
                                    </button>
                                </div>
                            </div>

                            {/* Current Time */}
                            <div className="mt-4 text-sm text-blue-100">
                                {t.lastUpdate}: {currentTime.toLocaleString(language === 'id' ? 'id-ID' : 'en-US')}
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="flex-1 container mx-auto px-4 py-8">
                        {/* Welcome Section */}
                        <div className="text-center mb-12">
                            <h2 className="text-4xl font-bold text-gray-800 mb-2">
                                {t.welcome}
                            </h2>
                            <p className="text-xl text-gray-600">{t.appTitle}</p>
                        </div>

                        {/* Modules Grid */}
                        <div className="mb-8">
                            <h3 className="text-2xl font-bold text-gray-800 mb-6">{t.modules}</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {modules.map((module) => (
                                    <div
                                        key={module.id}
                                        className={`module-card bg-white rounded-xl shadow-md overflow-hidden ${
                                            module.available ? 'cursor-pointer' : 'opacity-75'
                                        }`}
                                        onClick={() => handleModuleClick(module)}
                                    >
                                        <div className={`h-2 bg-gradient-to-r ${module.color}`}></div>
                                        <div className="p-6">
                                            <div className="flex items-center mb-4">
                                                <span className="text-4xl mr-3">{module.icon}</span>
                                                <h4 className="text-xl font-bold text-gray-800">
                                                    {t[module.titleKey]}
                                                </h4>
                                            </div>
                                            <p className="text-gray-600 mb-4 h-12">
                                                {t[module.descKey]}
                                            </p>
                                            <div className="flex items-center justify-between">
                                                {module.available ? (
                                                    <span className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                                                        {t.openModule}
                                                    </span>
                                                ) : (
                                                    <span className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-600">
                                                        {t.comingSoon}
                                                    </span>
                                                )}
                                                <svg
                                                    className={`w-5 h-5 ${
                                                        module.available ? 'text-blue-500' : 'text-gray-400'
                                                    }`}
                                                    fill="none"
                                                    stroke="currentColor"
                                                    viewBox="0 0 24 24"
                                                >
                                                    <path
                                                        strokeLinecap="round"
                                                        strokeLinejoin="round"
                                                        strokeWidth={2}
                                                        d="M9 5l7 7-7 7"
                                                    />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Quick Stats Section */}
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-12">
                            {/* Tasks by Status - Takes 2 columns on large screens */}
                            <div className="lg:col-span-2 bg-white rounded-lg shadow-md p-6">
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className="text-lg font-bold text-gray-800">{t.tasksByStatus}</h3>
                                    <div className="text-3xl">üìã</div>
                                </div>
                                {loading ? (
                                    <div className="text-gray-500 text-center py-4">Loading...</div>
                                ) : (
                                    <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
                                        {/* Total Tasks */}
                                        <div className="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4 border-l-4 border-blue-500">
                                            <p className="text-blue-600 text-xs font-medium mb-1">{t.totalTasks}</p>
                                            <p className="text-3xl font-bold text-blue-700">{taskCounts.total}</p>
                                        </div>
                                        {/* New Tasks */}
                                        <div className="bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg p-4 border-l-4 border-gray-500">
                                            <p className="text-gray-600 text-xs font-medium mb-1">{t.statusNew}</p>
                                            <p className="text-3xl font-bold text-gray-700">{taskCounts.new}</p>
                                        </div>
                                        {/* In Progress */}
                                        <div className="bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-lg p-4 border-l-4 border-yellow-500">
                                            <p className="text-yellow-600 text-xs font-medium mb-1">{t.statusInProgress}</p>
                                            <p className="text-3xl font-bold text-yellow-700">{taskCounts.inProgress}</p>
                                        </div>
                                        {/* Pending */}
                                        <div className="bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-4 border-l-4 border-orange-500">
                                            <p className="text-orange-600 text-xs font-medium mb-1">{t.statusPending}</p>
                                            <p className="text-3xl font-bold text-orange-700">{taskCounts.pending}</p>
                                        </div>
                                        {/* Done */}
                                        <div className="bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4 border-l-4 border-green-500">
                                            <p className="text-green-600 text-xs font-medium mb-1">{t.statusDone}</p>
                                            <p className="text-3xl font-bold text-green-700">{taskCounts.done}</p>
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Other Stats - Placeholders */}
                            <div className="space-y-6">
                                <div className="bg-white rounded-lg shadow-md p-6">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <p className="text-gray-600 text-sm mb-1">
                                                {language === 'id' ? 'Item Inventaris' : 'Inventory Items'}
                                            </p>
                                            <p className="text-3xl font-bold text-gray-800">--</p>
                                        </div>
                                        <div className="text-4xl">üì¶</div>
                                    </div>
                                </div>
                                <div className="bg-white rounded-lg shadow-md p-6">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <p className="text-gray-600 text-sm mb-1">
                                                {language === 'id' ? 'Total Ternak' : 'Total Livestock'}
                                            </p>
                                            <p className="text-3xl font-bold text-gray-800">--</p>
                                        </div>
                                        <div className="text-4xl">üêÑ</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>

                    {/* Footer */}
                    <footer className="bg-gray-800 text-white py-6 mt-12">
                        <div className="container mx-auto px-4 text-center">
                            <p className="text-gray-300">{t.footer}</p>
                        </div>
                    </footer>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
